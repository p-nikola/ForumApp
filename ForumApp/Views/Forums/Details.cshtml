@model ForumApp.Models.Forum

<link rel="stylesheet" type="text/css" href="~/Content/Forum/ForumDetails.css" />

<h2>@Model.Title</h2>
<p>@Model.Description</p>

<h3>Posts</h3>

@if (Model.Posts.Any(p=>p.IsApproved))
{
    <table id="postsTable" class="table">
        <thead>
            <tr>
                <th>@Html.DisplayNameFor(m => m.Title)</th>
                <th>Content</th>
                <th>Date Created</th>
                <th>Comments</th>
                <th>User</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var post in Model.Posts)
            {
                <tr>
                    <td>
                        @Html.ActionLink(post.Title, "Details", "Posts", new { id = post.PostId }, null)
                    </td>
                    <td>@post.Content</td>
                    <td>@post.DateCreated</td>
                    <td>@post.Comments.Count</td>
                    <td>
                        @Html.ActionLink(post.User.UserName, "Index", "Profile", new { id = post.UserId }, new { @class = "username-link" })
                        <img src="@post.User.ProfilePictureUrl" alt="Profile Picture" class="profile-picture" style="width:50px; height:50px;" />
                    </td>
                    <td>
                        <button data-post-id="@post.PostId" class="btn btn-danger js-delete">Delete Post</button>
                    </td>


                </tr>
            }
        </tbody>
    </table>
}
else
{
    <p>No posts yet. Be the first to post!</p>
}

<p>
    @Html.ActionLink("Create New Post", "Create", "Posts", new { forumId = Model.ForumId }, new { @class = "btn btn-primary" })
</p>

<div>
    @Html.ActionLink("Back to Forum List", "Index")
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            var table = $('#postsTable').DataTable();
            $("#postsTable .js-delete").on("click", function () {
                var button = $(this);
                bootbox.confirm("Are you sure you want to delete this post?", function (result) {
                    if (result) {
                        $.ajax({
                            url: "/Posts/DeletePost/" + button.attr("data-post-id"),
                            method: "GET",
                            success: function () {
                                table.row(button.parents("tr")).remove().draw();
                            },
                            error: function (err) {
                                console.log(err);
                            }
                        });
                    }
                });
            });

        });




    </script>
}
