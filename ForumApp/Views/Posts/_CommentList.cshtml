@model IEnumerable<ForumApp.Models.Comment>

<link rel="stylesheet" type="text/css" href="~/Content/Posts/PostsStyle.css" />

@foreach (var comment in Model)
{
    <div @if (comment.ParentCommentId.HasValue) { @: style="margin-left: 50px;"
         } else { @: style="margin-left: 0px;"
         }>
        <div id="comment-@comment.CommentId">
            <p>@comment.Content</p>

            <p>
                <small>
                    Posted on @comment.DateCreated by @Html.ActionLink(comment.User.UserName, "Index", "Profile", new { id = comment.UserId }, new { @class = "username-link" })
                    <img src="@comment.User.ProfilePictureUrl" alt="Profile Picture" class="profile-picture" style="width:100px;" />
                </small>
            </p>

            <div>
                <button type="button" class="btn btn-sm btn-success" onclick="upvoteComment(@comment.CommentId)">Upvote</button>
                <button type="button" class="btn btn-sm btn-danger" onclick="downvoteComment(@comment.CommentId)">Downvote</button>
                <span>Upvotes: <span id="comment-upvotes-@comment.CommentId">@comment.Upvotes</span></span>
                <span>Downvotes: <span id="comment-downvotes-@comment.CommentId">@comment.Downvotes</span></span>
            </div>
            <br />
            <button type="button" class="btn btn-sm btn-secondary reply-button" data-target="replyForm-@comment.CommentId">Reply</button>
        </div>

        <!-- Reply form using a partial view -->
        <div id="replyForm-@comment.CommentId" class="reply-form-container">
            @Html.Partial("_ReplyForm", new ForumApp.Models.CommentViewModel { PostId = comment.PostId, ParentCommentId = comment.CommentId })
        </div>

        <!-- Recursively display child comments -->
        @if (comment.Replies.Any())
        {
            @Html.Partial("_CommentList", comment.Replies)
        }
    </div>
}
